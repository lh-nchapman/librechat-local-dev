services:
  api:
    volumes:
      - type: bind
        source: ${HOME}/.config/gcloud/application_default_credentials.json
        target: /app/api/data/auth.json
      - type: bind
        source: ./librechat.yaml
        target: /app/librechat.yaml
      - type: bind
        source: ./images/logo.png
        target: /app/client/public/assets/logo.png
      - type: bind
        source: ./images/logo.png
        target: /app/client/dist/assets/logo.png
      - type: bind
        source: ./images/logo.svg
        target: /app/client/public/assets/logo.svg
      - type: bind
        source: ./images/logo.svg
        target: /app/client/dist/assets/logo.svg
      # Mount modified callbacks.js for diagnostic logging
      - type: bind
        source: ./api/server/controllers/agents/callbacks.js
        target: /app/api/server/controllers/agents/callbacks.js
    environment:
      - GOOGLE_APPLICATION_CREDENTIALS=/app/api/data/auth.json
      - NODE_ENV=development

  metrics:
    image: ghcr.io/virtuos/librechat_exporter:main
    container_name: librechat-metrics
    depends_on:
      - mongodb
    ports:
      - "8000:8000"
    restart: unless-stopped
    environment:
      - MONGODB_URI=mongodb://mongodb:27017/LibreChat
      - LOGGING_LEVEL=info
